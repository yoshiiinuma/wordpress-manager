# Get MySQL configuration from the cache and store as curdb
# 
# Required Args:
#   srchost: source host
#   subdomain: sub domain
#
# Prerequisites:
#   Run get-all-virtualhosts
#   Run get-all-wp-configs
#
---
- fail: msg="srchost is not provided"
  when: srchost is undefined
- fail: msg="subdomain is not provided"
  when: subdomain is undefined
- fail: msg="Facts for {{ srchost }} was not found; Run get-all-virtualhosts"
  when: hostvars[srchost] is undefined
- fail: msg="DB facts for {{ srchost }} was not found; Run get-all-wp-configs"
  when: hostvars[srchost]['db'] is undefined
- name: Set domain variable
  set_fact:
    domain: "{{ subdomain }}.hawaii.gov"
- fail: msg="DB facts for {{ domain }} was not found; Run get-all-wp-configs"
  when: hostvars[srchost]['db'][domain] is undefined
- name: Set currrent db variable
  set_fact:
    curdb: "{{ hostvars[srchost]['db'][domain] }}"
#- name: Debug db
#  debug:
#    var: curdb
